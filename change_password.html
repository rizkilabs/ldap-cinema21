<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Change Password</title>
    <style>
      /*
        /* Style change password form */
form {
display: flex;
flex-direction: column;
align-items: center;
margin-top: 50px;
}

input[type="password"] {
    margin-bottom: 20px;
    padding: 10px;
    width: 300px;
    font-size: 16px;
  }

  input[type="submit"] {
    background-color: #4CAF50;
    color: white;
    padding: 10px 20px;
    border: none;
    border-radius: 4px;
    cursor: pointer;
  }

  input[type="submit"]:hover {
    background-color: #45a049;
  }

  /* Style error message */
  #error-message {
    color: red;
    margin-bottom: 20px;
    font-size: 16px;
  }

  /* Style success message */
  #success-message {
    color: green;
    margin-bottom: 20px;
    font-size: 16px;
  }
</style>
</head>
<body>
  <form>
    <label for="current-password">Current Password:</label>
    <input type="password" id="current-password" name="current-password" required>
    <label for="new-password">New Password:</label>
    <input type="password" id="new-password" name="new-password" required>
  
    <label for="confirm-password">Confirm New Password:</label>
    <input type="password" id="confirm-password" name="confirm-password" required>
  
    <input type="submit" value="Change Password">
  </form>
  
  <div id="error-message"></div>
  <div id="success-message"></div>
  
  <script>
    const form = document.querySelector("form");
    const errorMessage = document.getElementById("error-message");
    const successMessage = document.getElementById("success-message");
  
    // Get username from query parameter
    const urlParams = new URLSearchParams(window.location.search);
    const username = urlParams.get("username");
  
    // Display username on page
    const usernameElement = document.createElement("p");
    usernameElement.innerText = "Logged in as: " + username;
    document.body.insertBefore(usernameElement, form);
  
    form.addEventListener("submit", event => {
      event.preventDefault();
  
      // Get form inputs
      const currentPassword = document.getElementById("current-password").value;
      const newPassword = document.getElementById("new-password").value;
      const confirmPassword = document.getElementById("confirm-password").value;
  
      // Validate form inputs
      if (currentPassword === "" || newPassword === "" || confirmPassword === "") {
        errorMessage.innerText = "All fields are required.";
        successMessage.innerText = "";
        return;
      }
  
      if (newPassword !== confirmPassword) {
        errorMessage.innerText = "New password and confirm password do not match.";
        successMessage.innerText = "";
        return;
      }
  
      // Send change password request to server
      fetch("http://localhost:4000/activedirectories/update-password", {
        method: "POST",
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify({
          username: username,
          currentPassword: currentPassword,
          password: newPassword
        })
      })
      .then(response => {
        if (!response.ok) {
          throw new Error("Change password failed");
        }
        return response.json();
      })
      .then(data => {
        // Change password successful, show success message
        console.log(data)
        successMessage.innerText = "Password changed successfully!";
        errorMessage.innerText = "";
      })
      .catch(error => {
        // Change password failed, show error message
        errorMessage.innerText = "Change password failed. Please check your current password and try again.";
      successMessage.innerText = "";
    });
  });
</script>
  